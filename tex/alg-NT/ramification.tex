\chapter{Ramification theory}
We're very interested in how rational primes $p$ factor in a bigger number field $K$.
Some examples of this behavior: in $\ZZ[i]$ (which is a UFD!), we have factorizations
\begin{align*}
	(2) &= (1+i)^2 \\
	(3) &= (3) \\
	(5) &= (2+i)(2-i).
\end{align*}
In this chapter we'll learn more about how primes break down when they're thrown into bigger number fields.
Using weapons from Galois Theory, this will culminate in a proof of Quadratic Reciprocity.

\section{Ramified / inert / split primes}
\prototype{In $\ZZ[i]$, $2$ is ramified, $3$ is inert, and $5$ splits.}

Let $p$ be a rational prime, and toss it into $\OO_K$.
Thus we get a factorization into prime ideals
\[ p \cdot \OO_K = \kp_1^{e_1} \dots \kp_g^{e_g}. \]
We say that each $\kp_i$ is \vocab{above} $(p)$.\footnote{%
	Reminder that $p \cdot \OO_K$ and $(p)$ mean the same thing, and I'll use both interchangeably.}
Pictorially, you might draw this as follows:
\begin{center}
\begin{tikzcd}
	K \ar[d, dash] & \supset & \OO_K \ar[d, dash] & \kp_i \ar[d, dash] \\
	\QQ & \supset & \ZZ & (p)
\end{tikzcd}
\end{center}
Some names for various behavior that can happen:
\begin{itemize}
	\ii We say $p$ is \vocab{ramified} if $e_i > 1$ for some $i$.
	For example $2$ is ramified in $\ZZ[i]$.
	\ii We say $p$ is \vocab{inert} if $g=1$ and $e_1=1$; i.e. $(p)$ remains prime.
	For example $3$ is inert in $\ZZ[i]$.
	\ii We say $p$ is \vocab{split} if $g > 1$.
	For example $5$ is split in $\ZZ[i]$.
\end{itemize}
\begin{ques}
	More generally, for a prime $p$ in $\ZZ[i]$:
	\begin{itemize}
		\ii $p$ is ramified exactly when $p = 2$.
		\ii $p$ is inert exactly when $p \equiv 3 \pmod 4$.
		\ii $p$ is split exactly when $p \equiv 1 \pmod 4$.
	\end{itemize}
	Prove this.
\end{ques}

\section{Primes ramify if and only if they divide $\Delta_K$}
The most unusual case is ramification:
Just like we don't expect a randomly selected polynomial to have a double root,
we don't expect a randomly selected prime to be ramified.
In fact, the key to understanding ramification is the discriminant.

For the sake of discussion, let's suppose that $K$ is monogenic,
$\OO_K = \ZZ[\theta]$, where $\theta$ has minimal polynomial $f$.
Let $p$ be a rational prime we'd like to factor.
If $f$ factors as $f_1^{e_1} \dots f_g^{e_g}$, then we know that
the prime factorization of $(p)$ is given by
\[ p \cdot \OO_K = \prod_i \left( p, f_i(\theta) \right)^{e_i}. \]
In particular, $p$ ramifies exactly when \emph{$f$ has a double root mod $p$}!
To detect whether this happens, we look at the polynomial discriminant of $f$,
namely
\[ \Delta(f) = \prod_{i<j} (z_i - z_j)^2 \]
and see whether it is zero mod $p$ -- thus $p$ ramifies if and only if this is true.

It turns out that the na\"{\i}ve generalization to any number field
works if we replace $\Delta(f)$ by just the discriminant $\Delta_K$ of $K$;
(these are the same for monogenic $\OO_K$ by \Cref{prob:root_discriminant}).
That is,
\begin{theorem}
	[Discriminant detects ramification]
	Let $p$ be a rational prime and $K$ a number field.
	Then $p$ is ramified if and only if $p$ divides $\Delta_K$.
\end{theorem}
\begin{example}[Ramification in the Gaussian integers]
	Let $K = \QQ(i)$ so $\OO_K = \ZZ[i]$ and $\Delta_K = 4$.
	As predicted, the only prime ramifying in $\ZZ[i]$ is $2$,
	the only prime factor of $\Delta_K$.
\end{example}
In particular, only finitely many primes ramify.

\section{Inertial degrees}
\prototype{$(7)$ has inertial degree $2$ in $\ZZ[i]$ and $(2+i)$ has inertial degree $1$ in $\ZZ[i]$.}

Recall that we were able to define an ideal norm
$\Norm(\ka) = \left\lvert \OO_K / \ka \right\rvert$
measuring how ``roomy'' the ideal $\ka$ is.
For example, $(5)$ has ideal norm $5^2 = 25$ in $\ZZ[i]$, since
\[ \ZZ[i] / (5) \cong \left\{ a+bi \mid a,b \in \Zc5 \right\} \]
has $5^2 = 25$ elements.

Now, let's look at
\[ p \cdot \OO_K = \kp_1^{e_1} \dots \kp_g^{e_g} \]
in $\OO_K$, where $K$ has degree $n$.
Taking the ideal norms of both sides, we have that
\[ p^n = \Norm(\kp_1)^{e_1} \dots \Norm(\kp_g)^{e_g}. \]
We conclude that $\kp_i = p^{f_i}$ for some integer $f_i \ge 1$, and moreover that
\[ n = \sum_{i=1}^g e_i f_i. \]
\begin{definition}
	We say $f_i$ is the \vocab{inertial degree} of $\kp_i$,
	and $e_i$ is the \vocab{ramification index}.
\end{definition}
\begin{example}[Examples of inertial degrees]
	Work in $\ZZ[i]$, which is degree $2$.
	The inertial degree detects how ``spacy'' the
	given $\kp$ is when interpreted in $\OO_K$.
	\begin{enumerate}[(a)]
		\ii The prime $7 \cdot \ZZ[i]$ has inertial degree $2$.
		Indeed, $\ZZ[i]/ (7)$ has $7^2=49$ elements,
		those of the form $a+bi$ for $a$, $b$ modulo $7$.
		It gives ``two degrees'' of space.
		\ii Let $(5) = (2+i)(2-i)$.
		The inertial degrees of $(2+i)$ and $(2-i)$ are both $1$.
		Indeed, $\ZZ[i] / (2+i)$ only gives ``one degree'' of space,
		since each of its elements can be viewed as integers modulo $5$,
		and there are only $5^1=5$ elements.
	\end{enumerate}
	If you understand this, it should be intuitively clear
	why the sum of $e_i f_i$ should equal $n$.
\end{example}

\section{The magic of Galois extensions}
OK, that's all fine and well.
But something \emph{really magical} happens when we add the
additional hypothesis that $K/\QQ$ is \emph{Galois}:
all the inertial degrees and ramification degrees are equal.
We set about proving this.

Let $K/\QQ$ be Galois with $G = \Gal(K/\QQ)$.
Note that if $\kp \subseteq \OO_K$ is a prime above $p$,
then the image $\sigma\im(\kp)$ is also prime for any $\sigma \in G$
(since $\sigma$ is an automorphism!).
Moreover, since $p \in \kp$ and $\sigma$ fixes $\QQ$,
we know that $p \in \sigma\im(\kp)$ as well.

Thus, by the pointwise mapping, \textbf{the Galois group acts
on the prime ideals above a rational prime $p$}.
Picture:
\begin{center}
	\begin{asy}
		size(6cm);
		pair P = MP("p", (0,-2.8), dir(-90));
		pair A = MP("\mathfrak p_1", 0.8*dir(210), origin);
		pair B = MP("\mathfrak p_2", 0.5*dir(140), origin);
		pair C = MP("\mathfrak p_3", dir(70), origin);
		pair D = MP("\mathfrak p_4", 1.2*dir(-15), origin);
		pair E = MP("\mathfrak p_5", 1.4*dir(15), origin);
		pair F = MP("\mathfrak p_6", 1.5*dir(135), origin);
		draw(dir(-90)--P);
		draw(A--D, dashed, EndArrow, Margin(3,3));
		label("$\sigma$", A--D, dir(-90));
	\end{asy}
\end{center}

The notation $\sigma\im(\kp)$ is hideous in this context,
since we're really thinking of $\sigma$ as just doing a group action,
and so we give the shorthand:
\begin{abuse}
	Let $\sigma\kp$ be shorthand for $\sigma\im(\kp)$.
\end{abuse}

Since the $\sigma$'s are all bijections (they are automorphisms!),
it should come as no surprise that the prime ideals which are in the same
orbit are closely related.
But miraculously, it turns out there is only one orbit!
\begin{theorem}
	[Galois group acts transitively]
	Let $K/\QQ$ be Galois with $G = \Gal(K/\QQ)$.
	Let $\{\kp_i\}$ be the set of distinct prime ideals in
	the factorization of $p \cdot \OO_K$ (in $\OO_K$).

	Then $G$ acts transitively on the $\kp_i$:
	for every $i$ and $j$, we can find $\sigma$ such that $\sigma\kp_i = \kp_j$.
\end{theorem}
\begin{proof}
	Fairly slick.
	Suppose for contradiction that no $\sigma \in G$ sends $\kp_1$ to $\kp_2$, say.
	By the Chinese remainder theorem, we can find an $x \in \OO_K$ such that
	\begin{align*}
		x &\equiv 0 \pmod{\kp_1} \\
		x &\equiv 1 \pmod{\kp_i} \text{ for $i \ge 2$}
		% \pmod{(\sigma\inv)\im(\kp_2)} \text{ for $\sigma \in G$.}
	\end{align*}
	Then, compute the norm
	\[ \NK(x) = \prod_{\sigma \in \Gal(K/\QQ)} \sigma(x). \]
	Each $\sigma(x)$ is in $K$ because $K/\QQ$ is Galois!

	Since $\NK(x)$ is an integer and divisible by $\kp_1$,
	we should have that $\NK(x)$ is divisible by $p$.
	Thus it should be divisible by $\kp_2$ as well.
	But by the way we selected $x$, we have $x \notin \sigma\inv\kp_2$ for every $\sigma \in G$!
	So $\sigma(x) \notin \kp_2$ for any $\sigma$, which is a contradiction.
\end{proof}
\begin{theorem}[Inertial degree and ramification indices are all equal]
	Assume $K/\QQ$ is Galois.
	Then for any rational prime $p$ we have
	\[ p \cdot \OO_K = \left( \kp_1 \kp_2 \dots \kp_g \right)^e \]
	for some $e$, where the $\kp_i$ are distinct prime ideals
	with the same inertial degree $f$.
	Hence \[ [K:\QQ] = efg. \]
\end{theorem}
\begin{proof}
	To see that the inertial degrees are equal, note that each $\sigma$
	induces an isomorphism
	\[ \OO_K / \kp \cong \OO_K / \sigma(\kp). \]
	Because the action is transitive, all $f_i$ are equal.
	\begin{exercise}
		Using the fact that $\sigma \in \Gal(K/\QQ)$,
		show that \[ \sigma\im(p \cdot \OO_K) = p \cdot \sigma\im(\OO_K) = p \cdot \OO_K. \]
	\end{exercise}
	So for every $\sigma$, we have that
	$p \cdot \OO_K = \prod \kp_i^{e_i} = \prod (\sigma\kp_i)^{e_i}$.
	Since the action is transitive, all $e_i$ are equal.
\end{proof}

Let's see an illustration of this.
\begin{example}[Factoring $5$ in a Galois/non-Galois extension]
	Let $p = 5$ be a prime.
	\begin{enumerate}[(a)]
		\ii Let $E = \QQ(\cbrt2)$.
		One can show that $\OO_E = \ZZ[\cbrt2]$, so 
		we use the Factoring Algorithm on the minimal polynomial $x^3-2$.
		Since $x^3-2 \equiv (x-3)(x^2+3x+9) \pmod 5$ is the irreducible factorization,
		we have that
		\[ (5) = (5,\cbrt2-3)(5, \cbrt4+3\cbrt2+9) \]
		which have inertial degrees $1$ and $2$, respectively.
		The fact that this is not uniform reflects that $E$ is not Galois.

		\ii Now let $K = \QQ(\cbrt2,\omega)$, which is the splitting
		field of $x^3-2$ over $\QQ$; now $K$ is Galois.
		It turns out that
		\[ \OO_K = \ZZ[\eps] \quad\text{where}\quad \eps \text { is a root of } t^6+3t^5-5t^3+3t+1. \]
		(this takes a lot of work to obtain, so we won't do it here).
		Modulo $5$ this has an irreducible factorization
		$(x^2+x+2)(x^2+3x+3)(x^2+4x+1) \pmod 5$,
		so by the Factorization Algorithm,
		\[ (5) = (5, \eps^2+\eps+2)(5, \eps^2+3\eps+3)(5, \eps^2+4\eps+1). \]
		This time all inertial degrees are $2$, as the theorem predicts for $K$ Galois.
	\end{enumerate}
\end{example}

\section{(Optional) Decomposition and inertia groups}
Let $p$ be a rational prime.
Thus
\[ p \cdot \OO_K = \left( \kp_1 \dots \kp_g \right)^e \]
and all the $\kp_i$ have inertial degree $f$.
Let $\kp$ denote a choice of the $\kp_i$.

We can look at both the fields $\OO_K / \kp$ and $\ZZ / p = \mathbb F_p$.
Naturally, since $\OO_K / \kp$ is a finite field we can view it as a field extension of $\FF_p$.
So we can get the diagram
\begin{center}
\begin{tikzcd}
	K \ar[d, dash] & \supset & \OO_K \ar[d, dash] & \kp \ar[d, dash]
		& \OO_K / \kp \cong \FF_{p^f} \ar[d, dash]  \\
	\QQ & \supset & \ZZ & (p)
		& \FF_p.
\end{tikzcd}
\end{center}
At the far right we have finite field extensions, which we know are \emph{really} well behaved.
So we ask:
\begin{quote}
	\itshape
	How are $\Gal\left( (\OO_K/\kp) / \FF_p \right)$
	and $\Gal(K/\QQ)$ related?
\end{quote}
Absurdly enough, there is an explicit answer:
\textbf{it's just the stabilizer of $\kp$, at least when
$p$ is unramified}.
\begin{definition}
	Let $D_\kp \subseteq \Gal(K/\QQ)$ be the stabilizer of $\kp$, that is
	\[ D_\kp \defeq \left\{ \sigma \in \Gal(K/\QQ) \mid \sigma\kp = \kp \right\}. \]
	We say $D_\kp$ is the \vocab{decomposition group} of $\kp$.
\end{definition}
Then, every $\sigma \in D_\kp$ induces an automorphism of $\OO_K / \kp$ by
\[ \alpha \mapsto \sigma(\alpha) \pmod\kp. \]
So there's a natural map
\[ D_\kp \taking\theta \Gal\left( (\OO_K/\kp) / \FF_p \right) \]
by declaring $\theta(\sigma)$ to just be ``$\sigma \pmod \kp$''.
The fact that $\sigma \in D_\kp$ (i.e.\ $\sigma$ fixes $\kp$)
ensures this map is well-defined.

\begin{theorem}[Decomposition group and Galois group]
	\label{thm:decomposition}
	Define $\theta$ as above. Then
	\begin{itemize}
		\ii $\theta$ is surjective, and
		\ii its kernel is a group of order $e$,
		the ramification index.
	\end{itemize}
	In particular, if $p$ is unramified then
	$D_\kp \cong \Gal\left( (\OO_K/\kp)/\FF_p \right)$.
\end{theorem}
(The proof is not hard, but a bit lengthy and in my opinion
not very enlightening.)

\begin{moral}
	If $p$ is unramified, then taking
	modulo $\kp$ gives
	$D_\kp \cong \Gal\left( (\OO_K/\kp) / \FF_p \right)$.
\end{moral}

But we know exactly what $\Gal\left( (\OO_K/\kp)/\FF_p \right)$ is!
We already have $ \OO_K / \kp \cong \FF_{p^f} $, and the Galois group is
\[
	\Gal\left( (\OO_K/\kp) / \FF_p \right)
	\cong \Gal\left( \FF_{p^f} / \FF_p \right)
	\cong \left< x \mapsto x^p \right>
	\cong \Zc f.
\]
So \[ D_\kp \cong \Zc f \] as well.

Let's now go back to
\[ D_\kp \taking\theta \Gal\left( (\OO_K/\kp) : \FF_p \right). \]
The kernel of $\theta$ is called the \vocab{inertia group}
and denoted $I_\kp \subseteq D_\kp$; it has order $e$.

This gives us a pretty cool sequence of subgroups
$\{1\} \subseteq I \subseteq D \subseteq G$
where $G$ is the Galois group (I'm dropping the $\kp$-subscripts now).
Let's look at the corresponding \emph{fixed fields} via the Fundamental theorem of Galois theory.
Picture:
\begin{center}
\begin{tikzcd}
	\kp \subset \OO_K \subset
		& K \ar[r, leftrightarrow] \ar[d, "\text{Ramify}"']
		& \{1\} \ar[d, "e"] \\
	\; & K^I \ar[d, "\text{Inert}"'] & I \ar[d, "f"] \\
	\; & K^D \ar[d, "\text{Split}"'] & D \ar[d, "g"] \\
	(p) \subset \ZZ \subset
		& \QQ \ar[r, leftrightarrow]
		& G
\end{tikzcd}
\end{center}
Something curious happens:
\begin{itemize}
	\ii When $(p)$ is lifted into $K^D$ it splits completely into $g$ unramified primes.
	Each of these has inertial degree $1$.
	\ii When the primes in $K^D$ are lifted to $K^I$, they remain inert, and now have
	inertial degree $f$.
	\ii When then lifted to $K$, they ramify with exponent $e$ (but don't split at all).
\end{itemize}
Picture:
In other words, the process of going from $1$ to $efg$
can be very nicely broken into the three steps above.
To draw this in the picture, we get
\begin{center}
\begin{tikzcd}
	(p) \ar[r]
		& \kp_1 \dots \kp_g \ar[r]
		& \kp_1 \dots \kp_g \ar[r]
		& (\kp_1 \dots \kp_g)^e \\
	\{f_i\}: & 1,\dots,1 & f,\dots,f & f,\dots,f \\
	\QQ \ar[r, dash, "\text{Split}"]
		& K^D \ar[r, dash, "\text{Inert}"]
		& K^I \ar[r, dash, "\text{Ramify}"]
		& K
\end{tikzcd}
\end{center}
In any case, in the ``typical'' case that there is no ramification,
we just have $K^I = K$.

\section{Tangential remark: more general Galois extensions}
All the discussion about Galois extensions
carries over if we replace $K/\QQ$ by some different Galois extension $K/F$.
Instead of a rational prime $p$ breaking down in $\OO_K$,
we would have a prime ideal $\kp$ of $F$ breaking down as
\[ \kp \cdot \OO_L = (\kP_1 \dots \kP_g)^e \]
in $\OO_L$ and then all results hold verbatim.
(The $\kP_i$ are primes in $L$ above $\kp$.)
Instead of $\FF_p$ we would have $\OO_F/\kp$.

The reason I choose to work with $F = \QQ$ is that capital Gothic $P$'s ($\kP$)
look \emph{really} terrifying.

\section\problemhead
\todo{more problems}
% Cyclic Galois groups?

\begin{dproblem}
	Prove that no rational prime $p$ can remain inert in
	$K = \QQ(\cbrt2, \omega)$, the splitting field of $x^3-2$.
	How does this generalize?
	\begin{hint}
		Show that no rational prime $p$ can remain
		inert if $\Gal(K/\QQ)$ is not cyclic.
		Indeed, if $p$ is inert then $D_p \cong \Gal(K/\QQ)$.
	\end{hint}
\end{dproblem}
